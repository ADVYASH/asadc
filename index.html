<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Minecraft SMP Whitelist Quiz with Discord Login</title>
</head>
<body>

<h1>Minecraft SMP (ASRP2) â€“ Whitelist Quiz</h1>

<!-- Discord Login Button -->
<button id="discord-login">Login with Discord</button>

<!-- Quiz section, hidden by default -->
<div id="quiz-container" style="display:none;">
  <h2>Quiz</h2>
  <form id="quiz-form">
    <div>
      <p>1. What is the main goal of the server?</p>
      <input type="text" id="q1" required />
    </div>
    <div>
      <p>2. How do you join the server?</p>
      <input type="text" id="q2" required />
    </div>
    <div>
      <p>3. What is the rule about griefing?</p>
      <input type="text" id="q3" required />
    </div>
    <div>
      <p>4. How do you obtain a rank?</p>
      <input type="text" id="q4" required />
    </div>
    <div>
      <p>5. What is the maximum build height?</p>
      <input type="text" id="q5" required />
    </div>
    <div>
      <p>6. How do you get items in the game?</p>
      <input type="text" id="q6" required />
    </div>
    <div>
      <p>7. Are PvP fights allowed anywhere?</p>
      <input type="text" id="q7" required />
    </div>
    <div>
      <p>8. How do you report a bug or issue?</p>
      <input type="text" id="q8" required />
    </div>
    <div>
      <p>9. What is the server's policy on advertising?</p>
      <input type="text" id="q9" required />
    </div>
    <div>
      <p>10. How do you access the server's Discord?</p>
      <input type="text" id="q10" required />
    </div>
    <div>
      <p>11. What is the server's rule about spamming?</p>
      <input type="text" id="q11" required />
    </div>
    <div>
      <p>12. How do you get help in-game?</p>
      <input type="text" id="q12" required />
    </div>
    <div>
      <p>13. Are cheats or hacks allowed?</p>
      <input type="text" id="q13" required />
    </div>
    <div>
      <p>14. How do you claim a territory?</p>
      <input type="text" id="q14" required />
    </div>
    <div>
      <p>15. What is the main chat channel for general discussion?</p>
      <input type="text" id="q15" required />
    </div>
    <button type="submit">Submit Quiz</button>
  </form>
</div>

<div id="result"></div>

<script>
  // Replace these with your actual data
  const clientId = 'YOUR_DISCORD_CLIENT_ID'; // Discord app client ID
  const redirectUri = 'http://localhost:8000'; // Your redirect URL
  const scope = 'identify';

  // Webhook URLs
  const userWebhookUrl = 'YOUR_USER_WEBHOOK_URL'; // Webhook for user info
  const resultWebhookUrl = 'YOUR_RESULT_WEBHOOK_URL'; // Webhook for quiz results

  let userData = {}; // To store logged-in user info

  document.getElementById('discord-login').onclick = () => {
    const authUrl = `https://discord.com/api/oauth2/authorize?client_id=${clientId}&redirect_uri=${encodeURIComponent(redirectUri)}&response_type=code&scope=${scope}`;
    window.location.href = authUrl;
  };

  // Handle redirect with code
  const urlParams = new URLSearchParams(window.location.search);
  const code = urlParams.get('code');

  if (code) {
    // Exchange code for access token and get user info
    fetch('/auth', { // Your server endpoint
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ code })
    })
    .then(res => res.json())
    .then(data => {
      if (data.allowed) {
        userData = data.userData;
        document.getElementById('quiz-container').style.display = 'block';
        document.getElementById('discord-login').style.display = 'none';
      } else {
        alert('You are not authorized to access this quiz.');
      }
    });
  }

  // Handle quiz submission
  document.getElementById('quiz-form').onsubmit = (e) => {
    e.preventDefault();
    const answers = {
      q1: document.getElementById('q1').value,
      q2: document.getElementById('q2').value,
      q3: document.getElementById('q3').value,
      q4: document.getElementById('q4').value,
      q5: document.getElementById('q5').value,
      q6: document.getElementById('q6').value,
      q7: document.getElementById('q7').value,
      q8: document.getElementById('q8').value,
      q9: document.getElementById('q9').value,
      q10: document.getElementById('q10').value,
      q11: document.getElementById('q11').value,
      q12: document.getElementById('q12').value,
      q13: document.getElementById('q13').value,
      q14: document.getElementById('q14').value,
      q15: document.getElementById('q15').value,
    };

    // Example scoring: count how many answers include 'correct' (customize as needed)
    let score = 0;
    // You can define correct answers and compare here for scoring
    // For simplicity, this example just assigns a dummy score
    score = Math.floor(Math.random() * 16); // Random score 0-15

    // Send quiz results to webhook
    fetch('/submit-quiz', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        userId: userData.id,
        userName: userData.username,
        answers: answers,
        score: score,
      }),
    }).then(res => res.json())
      .then(data => {
        document.getElementById('result').innerText = 'Quiz submitted! Your score: ' + score;
      });
  };
</script>

</body>
</html>
